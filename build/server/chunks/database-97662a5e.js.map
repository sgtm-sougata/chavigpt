{"version":3,"file":"database-97662a5e.js","sources":["../../../.svelte-kit/adapter-node/chunks/database.js"],"sourcesContent":["import { MongoClient, GridFSBucket } from \"mongodb\";\nconst MONGODB_URL = \"mongodb+srv://chavigpt:chavigpt@cluster0.qft5v9w.mongodb.net/?retryWrites=true&w=majority\";\nconst MONGODB_DB_NAME = \"chat-ui\";\nconst MONGODB_DIRECT_CONNECTION = \"false\";\nconst COOKIE_NAME = \"hf-chat\";\nconst HF_TOKEN = \"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\";\nconst HF_API_ROOT = \"https://api-inference.huggingface.co/models\";\nconst OPENAI_API_KEY = \"\";\nconst USE_LOCAL_WEBSEARCH = \"\";\nconst WEBSEARCH_ALLOWLIST = \"[]\";\nconst WEBSEARCH_BLOCKLIST = \"[]\";\nconst OPENID_CONFIG = '{\\n  \"PROVIDER_URL\": \"\",\\n  \"CLIENT_ID\": \"\",\\n  \"CLIENT_SECRET\": \"\",\\n  \"SCOPES\": \"\"\\n}';\nconst OPENID_CLIENT_ID = \"\";\nconst OPENID_CLIENT_SECRET = \"\";\nconst OPENID_SCOPES = \"openid profile\";\nconst OPENID_PROVIDER_URL = \"https://huggingface.co\";\nconst OPENID_TOLERANCE = \"\";\nconst OPENID_RESOURCE = \"\";\nconst MODELS = '[\\n    {\\n      \"name\": \"mistralai/Mistral-7B-Instruct-v0.1\",\\n      \"displayName\": \"mistralai/Mistral-7B-Instruct-v0.1\",\\n      \"description\": \"Mistral 7B is a new Apache 2.0 model, released by Mistral AI that outperforms Llama2 13B in benchmarks.\",\\n      \"websiteUrl\": \"https://mistral.ai/news/announcing-mistral-7b/\",\\n      \"preprompt\": \"\",\\n      \"chatPromptTemplate\" : \"<s>{{#each messages}}{{#ifUser}}[INST] {{#if @first}}{{#if @root.preprompt}}{{@root.preprompt}}\\\\n{{/if}}{{/if}}{{content}} [/INST]{{/ifUser}}{{#ifAssistant}}{{content}}</s>{{/ifAssistant}}{{/each}}\",\\n      \"parameters\": {\\n        \"temperature\": 0.1,\\n        \"top_p\": 0.95,\\n        \"repetition_penalty\": 1.2,\\n        \"top_k\": 50,\\n        \"truncate\": 3072,\\n        \"max_new_tokens\": 1024,\\n        \"stop\": [\"</s>\"]\\n      },\\n      \"promptExamples\": [\\n        {\\n          \"title\": \"Write an email from bullet list\",\\n          \"prompt\": \"As a restaurant owner, write a professional email to the supplier to get these products every week: \\\\n\\\\n- Wine (x10)\\\\n- Eggs (x24)\\\\n- Bread (x12)\"\\n        }, {\\n          \"title\": \"Code a snake game\",\\n          \"prompt\": \"Code a basic snake game in python, give explanations for each step.\"\\n        }, {\\n          \"title\": \"Assist in a task\",\\n          \"prompt\": \"How do I make a delicious lemon cheesecake?\"\\n        }\\n      ]\\n    }\\n]';\nconst OLD_MODELS = \"[]\";\nconst MESSAGES_BEFORE_LOGIN = \"\";\nconst client = new MongoClient(MONGODB_URL, {\n  directConnection: MONGODB_DIRECT_CONNECTION === \"true\"\n});\nclient.connect().catch(console.error);\nconst db = client.db(MONGODB_DB_NAME + \"\");\nconst conversations = db.collection(\"conversations\");\nconst sharedConversations = db.collection(\"sharedConversations\");\nconst abortedGenerations = db.collection(\"abortedGenerations\");\nconst settings = db.collection(\"settings\");\nconst users = db.collection(\"users\");\nconst sessions = db.collection(\"sessions\");\nconst messageEvents = db.collection(\"messageEvents\");\nconst bucket = new GridFSBucket(db, { bucketName: \"files\" });\nconst collections = {\n  conversations,\n  sharedConversations,\n  abortedGenerations,\n  settings,\n  users,\n  sessions,\n  messageEvents,\n  bucket\n};\nclient.on(\"open\", () => {\n  conversations.createIndex(\n    { sessionId: 1, updatedAt: -1 },\n    { partialFilterExpression: { sessionId: { $exists: true } } }\n  ).catch(console.error);\n  conversations.createIndex(\n    { userId: 1, updatedAt: -1 },\n    { partialFilterExpression: { userId: { $exists: true } } }\n  ).catch(console.error);\n  abortedGenerations.createIndex({ updatedAt: 1 }, { expireAfterSeconds: 30 }).catch(console.error);\n  abortedGenerations.createIndex({ conversationId: 1 }, { unique: true }).catch(console.error);\n  sharedConversations.createIndex({ hash: 1 }, { unique: true }).catch(console.error);\n  settings.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  settings.createIndex({ userId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  users.createIndex({ hfUserId: 1 }, { unique: true }).catch(console.error);\n  users.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  messageEvents.createIndex({ createdAt: 1 }, { expireAfterSeconds: 60 }).catch(console.error);\n  sessions.createIndex({ expiresAt: 1 }, { expireAfterSeconds: 0 }).catch(console.error);\n  sessions.createIndex({ sessionId: 1 }, { unique: true }).catch(console.error);\n});\nexport {\n  COOKIE_NAME as C,\n  HF_TOKEN as H,\n  MESSAGES_BEFORE_LOGIN as M,\n  OPENAI_API_KEY as O,\n  USE_LOCAL_WEBSEARCH as U,\n  WEBSEARCH_ALLOWLIST as W,\n  WEBSEARCH_BLOCKLIST as a,\n  MODELS as b,\n  collections as c,\n  OLD_MODELS as d,\n  HF_API_ROOT as e,\n  OPENID_CONFIG as f,\n  OPENID_CLIENT_ID as g,\n  OPENID_CLIENT_SECRET as h,\n  OPENID_PROVIDER_URL as i,\n  OPENID_SCOPES as j,\n  OPENID_TOLERANCE as k,\n  OPENID_RESOURCE as l\n};\n"],"names":[],"mappings":"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"}