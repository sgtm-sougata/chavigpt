{"version":3,"file":"_server.ts-25a4f652.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/conversation/_id_/output/_sha256_/_server.ts.js"],"sourcesContent":["import { a as authCondition } from \"../../../../../../chunks/auth.js\";\nimport { c as collections } from \"../../../../../../chunks/database.js\";\nimport { e as error } from \"../../../../../../chunks/index.js\";\nimport { ObjectId } from \"mongodb\";\nimport { z } from \"zod\";\nimport { d as downloadFile } from \"../../../../../../chunks/downloadFile.js\";\nconst GET = async ({ locals, params }) => {\n  const sha256 = z.string().parse(params.sha256);\n  const userId = locals.user?._id ?? locals.sessionId;\n  if (!userId) {\n    throw error(401, \"Unauthorized\");\n  }\n  if (params.id.length !== 7) {\n    const convId = new ObjectId(z.string().parse(params.id));\n    const conv = await collections.conversations.findOne({\n      _id: convId,\n      ...authCondition(locals)\n    });\n    if (!conv) {\n      throw error(404, \"Conversation not found\");\n    }\n  } else {\n    const conv = await collections.sharedConversations.findOne({\n      _id: params.id\n    });\n    if (!conv) {\n      throw error(404, \"Conversation not found\");\n    }\n  }\n  const { content, mime } = await downloadFile(sha256, params.id);\n  return new Response(content, {\n    headers: {\n      \"Content-Type\": mime ?? \"application/octet-stream\"\n    }\n  });\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAMK,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK;AAC1C,EAAE,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AACjD,EAAE,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,EAAE,GAAG,IAAI,MAAM,CAAC,SAAS,CAAC;AACtD,EAAE,IAAI,CAAC,MAAM,EAAE;AACf,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,cAAc,CAAC,CAAC;AACrC,GAAG;AACH,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE;AAC9B,IAAI,MAAM,MAAM,GAAG,IAAI,QAAQ,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;AAC7D,IAAI,MAAM,IAAI,GAAG,MAAM,WAAW,CAAC,aAAa,CAAC,OAAO,CAAC;AACzD,MAAM,GAAG,EAAE,MAAM;AACjB,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;AAC9B,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,MAAM,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;AACjD,KAAK;AACL,GAAG,MAAM;AACT,IAAI,MAAM,IAAI,GAAG,MAAM,WAAW,CAAC,mBAAmB,CAAC,OAAO,CAAC;AAC/D,MAAM,GAAG,EAAE,MAAM,CAAC,EAAE;AACpB,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,MAAM,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;AACjD,KAAK;AACL,GAAG;AACH,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;AAClE,EAAE,OAAO,IAAI,QAAQ,CAAC,OAAO,EAAE;AAC/B,IAAI,OAAO,EAAE;AACb,MAAM,cAAc,EAAE,IAAI,IAAI,0BAA0B;AACxD,KAAK;AACL,GAAG,CAAC,CAAC;AACL;;;;"}