{"version":3,"file":"0-233ddf58.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_layout.server.ts.js","../../../.svelte-kit/adapter-node/nodes/0.js"],"sourcesContent":["import { c as collections, U as USE_LOCAL_WEBSEARCH } from \"../../chunks/database.js\";\nimport { U as UrlDependency } from \"../../chunks/UrlDependency.js\";\nimport { v as validateModel, d as defaultModel, m as models, o as oldModels } from \"../../chunks/models.js\";\nimport { a as authCondition, r as requiresUser } from \"../../chunks/auth.js\";\nimport { D as DEFAULT_SETTINGS } from \"../../chunks/Settings.js\";\nconst load = async ({ locals, depends }) => {\n  const { conversations } = collections;\n  depends(UrlDependency.ConversationList);\n  const settings = await collections.settings.findOne(authCondition(locals));\n  if (settings && !validateModel(models).safeParse(settings?.activeModel).success) {\n    settings.activeModel = defaultModel.id;\n    await collections.settings.updateOne(authCondition(locals), {\n      $set: { activeModel: defaultModel.id }\n    });\n  }\n  if (settings?.activeModel && models.find((m) => m.id === settings?.activeModel)?.unlisted === true) {\n    settings.activeModel = defaultModel.id;\n    await collections.settings.updateOne(authCondition(locals), {\n      $set: { activeModel: defaultModel.id }\n    });\n  }\n  const totalMessages = (await conversations.aggregate([\n    { $match: authCondition(locals) },\n    { $project: { messages: 1 } },\n    { $unwind: \"$messages\" },\n    { $match: { \"messages.from\": \"assistant\" } },\n    { $count: \"messages\" }\n  ]).toArray())[0]?.messages ?? 0;\n  const messagesBeforeLogin = 0;\n  const userHasExceededMessages = messagesBeforeLogin > 0 && totalMessages > messagesBeforeLogin;\n  const loginRequired = requiresUser && !locals.user && userHasExceededMessages;\n  return {\n    conversations: await conversations.find(authCondition(locals)).sort({ updatedAt: -1 }).project({\n      title: 1,\n      model: 1,\n      _id: 1,\n      updatedAt: 1,\n      createdAt: 1\n    }).map((conv) => ({\n      id: conv._id.toString(),\n      title: settings?.hideEmojiOnSidebar ? conv.title.replace(/\\p{Emoji}/gu, \"\") : conv.title,\n      model: conv.model ?? defaultModel,\n      updatedAt: conv.updatedAt\n    })).toArray(),\n    settings: {\n      searchEnabled: !!USE_LOCAL_WEBSEARCH,\n      ethicsModalAccepted: !!settings?.ethicsModalAcceptedAt,\n      ethicsModalAcceptedAt: settings?.ethicsModalAcceptedAt ?? null,\n      activeModel: settings?.activeModel ?? DEFAULT_SETTINGS.activeModel,\n      hideEmojiOnSidebar: settings?.hideEmojiOnSidebar ?? false,\n      shareConversationsWithModelAuthors: settings?.shareConversationsWithModelAuthors ?? DEFAULT_SETTINGS.shareConversationsWithModelAuthors,\n      customPrompts: settings?.customPrompts ?? {}\n    },\n    models: models.map((model) => ({\n      id: model.id,\n      name: model.name,\n      websiteUrl: model.websiteUrl,\n      modelUrl: model.modelUrl,\n      datasetName: model.datasetName,\n      datasetUrl: model.datasetUrl,\n      displayName: model.displayName,\n      description: model.description,\n      promptExamples: model.promptExamples,\n      parameters: model.parameters,\n      preprompt: model.preprompt,\n      multimodal: model.multimodal,\n      unlisted: model.unlisted\n    })),\n    oldModels,\n    user: locals.user && {\n      username: locals.user.username,\n      avatarUrl: locals.user.avatarUrl,\n      email: locals.user.email\n    },\n    loginRequired,\n    loginEnabled: requiresUser,\n    guestMode: requiresUser && messagesBeforeLogin > 0\n  };\n};\nexport {\n  load\n};\n","import * as server from '../entries/pages/_layout.server.ts.js';\n\nexport const index = 0;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_layout.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/+layout.server.ts\";\nexport const imports = [\"_app/immutable/nodes/0.eafdc246.js\",\"_app/immutable/chunks/boolean_attributes.9921dbdc.js\",\"_app/immutable/chunks/index.369f2cd8.js\",\"_app/immutable/chunks/close.b8c63ca1.js\",\"_app/immutable/chunks/singletons.87a67235.js\",\"_app/immutable/chunks/settings.b07edce2.js\",\"_app/immutable/chunks/stores.acee8332.js\",\"_app/immutable/chunks/index.449a376b.js\",\"_app/immutable/chunks/titleUpdate.b9dbf5b1.js\",\"_app/immutable/chunks/Logo.1e236891.js\",\"_app/immutable/chunks/each.623f0545.js\",\"_app/immutable/chunks/checkmark.484d3311.js\",\"_app/immutable/chunks/trash-can.5da0256d.js\"];\nexport const stylesheets = [\"_app/immutable/assets/0.ebbbc87f.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}